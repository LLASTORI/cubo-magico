# Relatório de Segurança — npm audit (`--json`)

- **Data:** 2026-02-23
- **Comando base:** `npm audit --json`
- **Resultado bruto:** 21 vulnerabilidades (2 critical, 14 high, 5 moderate)
- **Contexto do projeto:** aplicação React/Vite publicada como frontend; sem backend Node em produção neste repositório.

## Regras de decisão aplicadas

1. Vulnerabilidades **runtime** com severidade **high/critical** ⇒ **bloqueiam release até correção**.
2. Vulnerabilidades **somente de desenvolvimento** e sem caminho plausível de exploração em produção ⇒ **aceite temporário** com prazo e responsável.

## Classificação por item

| Item | Severidade | Runtime vs DevDependency | Superfície exposta | Exploit relevante no contexto do projeto | Decisão |
|---|---|---|---|---|---|
| `jspdf` | critical | runtime (dependency direta) | cliente (bundle browser) | **Sim**. O projeto gera PDF no cliente com dados dinâmicos, e os advisories incluem injeção em PDF e execução de JS no documento gerado. | **BLOCK RELEASE** |
| `jspdf-autotable` | critical | runtime (dependency direta) | cliente (bundle browser) | **Sim** (herda exposição de `jspdf`). | **BLOCK RELEASE** |
| `react-router-dom` | high | runtime (dependency direta) | cliente (roteamento SPA) | **Sim, potencial**. Advisory aponta redirecionamento externo inesperado/XSS via open redirect; risco depende de uso de paths/URL não confiáveis. | **BLOCK RELEASE** |
| `react-router` | high | runtime (transitiva) | cliente (roteamento SPA) | **Sim, potencial** (mesmo vetor de `react-router-dom`). | **BLOCK RELEASE** |
| `@remix-run/router` | high | runtime (transitiva) | cliente (roteamento SPA) | **Sim, potencial** (mesmo vetor de roteamento). | **BLOCK RELEASE** |
| `lodash` | moderate | runtime (transitiva via `recharts`) | cliente (processamento em runtime) | Baixa relevância prática no contexto atual; não altera critério de bloqueio (moderate). | Mitigar em ciclo normal |
| `vite` | moderate | devDependency direta | build local / dev server | Não para produção publicada (sem servidor Node em produção). Relevante apenas no ambiente de desenvolvimento. | Aceite temporário |
| `esbuild` | moderate | devDependency transitiva (via `vite`) | build local / dev server | Não há exploração em produção estática; vetor principal é dev server local. | Aceite temporário |
| `eslint` | high | devDependency direta | build/lint local | Sem caminho de exploração em runtime do produto. | Aceite temporário |
| `@eslint/config-array` | high | devDependency transitiva | build/lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@eslint/eslintrc` | high | devDependency transitiva | build/lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `minimatch` | high | devDependency transitiva | build/lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `glob` | high | devDependency transitiva | build local/CLI | Advisory é em CLI (`-c/--cmd`); não é fluxo de produção. | Aceite temporário |
| `ajv` | moderate | devDependency transitiva | build/lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `js-yaml` | moderate | devDependency transitiva | build/lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `typescript-eslint` | high | devDependency direta | lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@typescript-eslint/eslint-plugin` | high | devDependency transitiva | lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@typescript-eslint/parser` | high | devDependency transitiva | lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@typescript-eslint/type-utils` | high | devDependency transitiva | lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@typescript-eslint/typescript-estree` | high | devDependency transitiva | lint local | Sem caminho de exploração em produção. | Aceite temporário |
| `@typescript-eslint/utils` | high | devDependency transitiva | lint local | Sem caminho de exploração em produção. | Aceite temporário |

## Aceite temporário (somente dev, sem exploração em produção)

- **Escopo:** `vite`, `esbuild`, `eslint` e cadeia `typescript-eslint` + transitivas (`minimatch`, `glob`, `ajv`, `js-yaml`, etc.)
- **Justificativa:** riscos restritos a ambiente local de desenvolvimento/CI; não compõem runtime entregue ao usuário final.
- **Prazo máximo para saneamento:** **2026-03-31**
- **Responsável:** **Time de Plataforma Frontend (owner: @frontend-platform)**
- **Plano de ação:**
  1. Atualizar `eslint`/`typescript-eslint` para versões sem advisories compatíveis com a base.
  2. Atualizar `vite` para versão corrigida e validar pipeline de build.
  3. Reexecutar `npm audit --json` e anexar novo relatório.

## Gate de release

- Existem vulnerabilidades **runtime high/critical** em `jspdf`, `jspdf-autotable`, `react-router-dom`, `react-router` e `@remix-run/router`.
- **Status:** release **bloqueada** até correção/upgrade e validação de regressão.

## Evidências técnicas usadas

- `npm audit --json` (arquivo `audit-report.json`)
- `npm ls --all --depth=4 ...` para validar cadeia de dependências e classificação runtime/dev.
- Uso de `jsPDF` no código (`src/components/funnel/ExecutiveReport.tsx`), confirmando exposição em runtime cliente.
